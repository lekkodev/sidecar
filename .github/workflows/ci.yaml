name: ci
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: checkout config
        uses: actions/checkout@v3
        with:
          repository: lekkodev/example
          token: ${{ secrets.LEKKO_CI_GITHUB_PAT }}
          path: ci-example
      - name: run sidecar
        run: |
          cargo run -- --repo-path=$GITHUB_WORKSPACE/ci-example --mode=static
      - name: ci
        run: make
